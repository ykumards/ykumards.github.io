<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    
        <title>Adding Dropout</title>
    

    <meta name="description" content="notes">

    

    <link rel="icon" href="/assets/img/favicon.png">
    <link href='https://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>
    <!-- <link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">  -->
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css">
    <link href="/assets/css/syntax.css" rel="stylesheet">
</head>

<body>

    <div class="wrapper">
        <div class="post">
  <a class="post__back" href="/">&lt;-- home</a>
  <h1 class="post__title">Adding Dropout</h1>
  <p class="post__date">March 1, 2018</p>

  <ul class="tags">
      Tags:
      
  </ul>

  <div class="post__content"?>
    <p><a alt="Dropout" href="https://machinelearningflashcards.com">
    <img src="/images/machine_learning_flashcards/Dropout_print.png" class="flashcard center-block" />
</a></p>

<h2 id="preliminaries">Preliminaries</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Load libraries</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">keras.datasets</span> <span class="kn">import</span> <span class="n">imdb</span>
<span class="kn">from</span> <span class="nn">keras.preprocessing.text</span> <span class="kn">import</span> <span class="n">Tokenizer</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">keras</span> <span class="kn">import</span> <span class="n">layers</span>

<span class="c"># Set random seed</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre>
</div>

<div class="highlighter-rouge"><pre class="highlight"><code>Using TensorFlow backend.
</code></pre>
</div>

<h2 id="load-imdb-movie-review-data">Load IMDB Movie Review Data</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Set the number of features we want</span>
<span class="n">number_of_features</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="c"># Load data and target vector from movie review data</span>
<span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_target</span><span class="p">),</span> <span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span> <span class="o">=</span> <span class="n">imdb</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">number_of_features</span><span class="p">)</span>

<span class="c"># Convert movie review data to a one-hot encoded feature matrix</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">Tokenizer</span><span class="p">(</span><span class="n">num_words</span><span class="o">=</span><span class="n">number_of_features</span><span class="p">)</span>
<span class="n">train_features</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">sequences_to_matrix</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'binary'</span><span class="p">)</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">sequences_to_matrix</span><span class="p">(</span><span class="n">test_data</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'binary'</span><span class="p">)</span>
</code></pre>
</div>

<h2 id="construct-neural-network-architecture-with-dropout-layer">Construct Neural Network Architecture With Dropout Layer</h2>

<p>In Keras, we can implement dropout by added <code class="highlighter-rouge">Dropout</code> layers into our network architecture. Each <code class="highlighter-rouge">Dropout</code> layer will drop a user-defined hyperparameter of units in the previous layer every batch. Remember in Keras the input layer is assumed to be the first layer and not added using the <code class="highlighter-rouge">add</code>. Therefore, if we want to add dropout to the input layer, the layer we add in our is a dropout layer. This layer contains both the proportion of the input layerâ€™s units to drop <code class="highlighter-rouge">0.2</code> and <code class="highlighter-rouge">input_shape</code> defining the shape of the observation data. Next, after we add a dropout layer with <code class="highlighter-rouge">0.5</code> after each of the hidden layers.</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Start neural network</span>
<span class="n">network</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Sequential</span><span class="p">()</span>

<span class="c"># Add a dropout layer for input layer</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">input_shape</span><span class="o">=</span><span class="p">(</span><span class="n">number_of_features</span><span class="p">,)))</span>

<span class="c"># Add fully connected layer with a ReLU activation function</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">))</span>

<span class="c"># Add a dropout layer for previous hidden layer</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>

<span class="c"># Add fully connected layer with a ReLU activation function</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'relu'</span><span class="p">))</span>

<span class="c"># Add a dropout layer for previous hidden layer</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dropout</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>

<span class="c"># Add fully connected layer with a sigmoid activation function</span>
<span class="n">network</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">layers</span><span class="o">.</span><span class="n">Dense</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">activation</span><span class="o">=</span><span class="s">'sigmoid'</span><span class="p">))</span>
</code></pre>
</div>

<h2 id="compile-neural-network">Compile Neural Network</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Compile neural network</span>
<span class="n">network</span><span class="o">.</span><span class="nb">compile</span><span class="p">(</span><span class="n">loss</span><span class="o">=</span><span class="s">'binary_crossentropy'</span><span class="p">,</span> <span class="c"># Cross-entropy</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="s">'rmsprop'</span><span class="p">,</span> <span class="c"># Root Mean Square Propagation</span>
                <span class="n">metrics</span><span class="o">=</span><span class="p">[</span><span class="s">'accuracy'</span><span class="p">])</span> <span class="c"># Accuracy performance metric</span>
</code></pre>
</div>

<h2 id="train-neural-network">Train Neural Network</h2>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="c"># Train neural network</span>
<span class="n">history</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_features</span><span class="p">,</span> <span class="c"># Features</span>
                      <span class="n">train_target</span><span class="p">,</span> <span class="c"># Target vector</span>
                      <span class="n">epochs</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="c"># Number of epochs</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="c"># No output</span>
                      <span class="n">batch_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="c"># Number of observations per batch</span>
                      <span class="n">validation_data</span><span class="o">=</span><span class="p">(</span><span class="n">test_features</span><span class="p">,</span> <span class="n">test_target</span><span class="p">))</span> <span class="c"># Data for evaluation</span>
</code></pre>
</div>

  </div>
  

</div>

    </div>

</body>

</html>
